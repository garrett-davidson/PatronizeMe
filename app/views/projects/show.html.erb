
<p id="notice"><%= notice %></p>
<div class="card">
  <h3 class="card-header"><%=@project.name%></h3>
  <div class="card-body">
    <a href="<%=user_path(@project.owner)%>" class="card-link"><%=@project.owner.username%></a>
    <p class="card-text"><%=@project.description%></p>
    <p class="card-text"><%= pluralize(@project.supporters.count, 'supporter') %><%= '  $' + @project.total_funding.to_s + ' Pledged' %></p>
    <%if @project.status == 1%>
    <p class="card-text">Status: Open</p>
    <%else%>
    <p class="card-text">Status: Closed</p>
    <%end%>
    <a href="<%=@project.githublink%>" class="btn btn-primary active">GitHub</a>
  </div>
</div>
<%if @project.issues.any? %>
<div class="card">
  <h3 class="card-header">Issues</h3>
  <% @project.issues.each do |issue| %>
  <div class="card">
    <div class="card-body">
      <a href="<%=@project.githublink%>\issues\<%=issue.id%>" class="card-link"><%=issue.name%></a>
      <%if issue.status == 1%>
      <h5 class="card-subtitle mb-2">Open</h5>
      <% elsif issue.status == 2%>
      <h5 class="card-subtitle mb-2 ">Working on</h5>
      <%else%>
      <h5 class="card-subtitle mb-2 text-muted">Closed</h5>
      <%end%>
      <%if issue.supporters.include? current_user%>
      <div class="row align-items-center">
        <h6 class="card-text font-weight-normal col-12"><%=issue.description%></h6>
        <h6 class="card-text font-weight-normal col-2">Supporters: <%=issue.issue_transactions.count%></h6>
        <h6 class="card-text font-weight-normal col-7">Pledged: $<%=issue.total_funding%></h6>
        <h6 class="card-text font-weight-normal col-2">My pledge: $<%=issue.total_funding%></h6>
        <%if issue.status == 1%>
        <button type="button" class="btn btn-danger col-1" data-toggle="modal" data-target="#ModalCenterCancel">
          Cancel Support
        </button>
        <%end%>
      </div>
      <%else%>
      <div class="row align-items-center">
        <h6 class="card-text font-weight-normal col-12"><%=issue.description%></h6>
        <h6 class="card-text font-weight-normal col-2">Supporters: <%=issue.issue_transactions.count%></h6>
        <h6 class="card-text font-weight-normal col-9">Pledged: $<%=issue.total_funding%></h6>
        <%if issue.status == 1%>
        <button type="button" class="btn btn-success col-1" data-toggle="modal" data-issueid=<%= issue.id %> data-target="#ModalCenter">
          Support
        </button>
        <%end%>
      </div>
      <%end%>
    </div>
  </div>
  <% end %>
</div>
<%end%>
<div class="modal fade" id="ModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <% if user_signed_in? %>
        <h5 class="modal-title" id="exampleModalLongTitle">Supporting</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
        <%else%>
        <h5 class="modal-title" id="exampleModalLongTitle">Sign Up</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
        <%end%>
      </div>
      <% if user_signed_in? %>
      <div class="modal-body">
        You can take out your money as long as the issue has not been started.
        <div class="modal-footer">
          <div class="input-group">
            <div class="input-group-prepend">
              <span class="input-group-text">$</span>
            </div>
            <input type="text" class="form-control" aria-label="Amount (to the nearest dollar)">
            <div class="input-group-append">
              <span class="input-group-text">.00</span>
            </div>
          </div>
          <button type="button" class="btn btn-primary"> Support </button>
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Exit</button>
        </div>
      </div>
      <%else%>
      <div class="modal-body">
        You need to be signed in to support a project.
        <div class="modal-footer">
          <a href="<%=new_user_session_path%>" class="btn btn-primary active">Sign Up</a>
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Exit</button>
        </div>
      </div>
      <%end%>
    </div>
  </div>
</div>
<div class="modal fade" id="ModalCenterCancel" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLongTitle">Supporting</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        Are you sure you want to cancel your support?
        <div class="modal-footer">
          <button type="button" class="btn btn-primary">Cancel</button>
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Exit</button>
        </div>
      </div>
    </div>
  </div>
</div>
<script>

  $('#ModalCenter').on('show.bs.modal', function (event) {
      var button = $(event.relatedTarget) // Button that triggered the modal
      var recipient = button.data('issueid') // Extract info from data-* attributes
      // If necessary, you could initiate an AJAX request here (and then do the updating in a callback).
      // Update the modal's content. We'll use jQuery here, but you could use a data binding library or other methods instead.
      var modal = $(this)
      modal.find('.modal-title').text('Issue ID: ' + recipient)
    })

  </script>